<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ichbinhandsome.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="somthing interesting">
<meta property="og:type" content="website">
<meta property="og:title" content="Ruixiang&#39;s blog">
<meta property="og:url" content="https://ichbinhandsome.github.io/index.html">
<meta property="og:site_name" content="Ruixiang&#39;s blog">
<meta property="og:description" content="somthing interesting">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Ruixiang Wang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://ichbinhandsome.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Ruixiang's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Ruixiang's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">work harder, study better, do faster, become stronger</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ichbinhandsome.github.io/2024/03/10/LLM-attention/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruixiang Wang">
      <meta itemprop="description" content="somthing interesting">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruixiang's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/10/LLM-attention/" class="post-title-link" itemprop="url">Multi-Head & Multi-Query & Grouped-Query & Sliding-Window Attention Implementation</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-03-10 22:52:40" itemprop="dateCreated datePublished" datetime="2024-03-10T22:52:40+01:00">2024-03-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-03-17 02:31:00" itemprop="dateModified" datetime="2024-03-17T02:31:00+01:00">2024-03-17</time>
              </span>

          
            <span id="/2024/03/10/LLM-attention/" class="post-meta-item leancloud_visitors" data-flag-title="Multi-Head & Multi-Query & Grouped-Query & Sliding-Window Attention Implementation" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>During current advancement of LLM, many different attention methods beyond Multi-Head Attention (MQA) from original Transformer model have been proposed, such as Multi-Query Attention (MQA) from Falcon, Grouped-Query Attention (GQA) from Llama and Sliding-Window Attention (SWA) from Mistral. Both MQA and GQA aim to save GPU memory (i.e. <em>reduce the size of Key &amp; Value projection matrices during attention</em>) and speed up attention calculation (i.e. <em>reduce size of KV cache so that read data faster and support for large batch size</em>) without too much model performance degradation. Sliding-Window attention (SWA) is a technique used in transformer models to limit the attention span of each token to a fixed size window around it, which reduces the computational complexity and makes the model more efficient.<br>This blog will implement all these different attention mechanisms from scratch using PyTorch.</p>
<p><img src="https://raw.githubusercontent.com/ichbinhandsome/images/main/202401012100201.png" alt="multi_query_attention"></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/03/10/LLM-attention/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ichbinhandsome.github.io/2024/01/07/MoE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruixiang Wang">
      <meta itemprop="description" content="somthing interesting">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruixiang's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/07/MoE/" class="post-title-link" itemprop="url">MoE (Mix-of-Expert) Model</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-07 20:48:06" itemprop="dateCreated datePublished" datetime="2024-01-07T20:48:06+01:00">2024-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-01-22 01:26:59" itemprop="dateModified" datetime="2024-01-22T01:26:59+01:00">2024-01-22</time>
              </span>

          
            <span id="/2024/01/07/MoE/" class="post-meta-item leancloud_visitors" data-flag-title="MoE (Mix-of-Expert) Model" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This image shows the basic structure of MoE. (<em><a target="_blank" rel="noopener" href="https://github.com/mistralai/mistral-src">source</a></em>)<br><img src="https://raw.githubusercontent.com/ichbinhandsome/images/main/202401220102255.png" alt="moe"></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/01/07/MoE/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ichbinhandsome.github.io/2023/12/26/KV-Cache-in-Transformer-Inference/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruixiang Wang">
      <meta itemprop="description" content="somthing interesting">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruixiang's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/26/KV-Cache-in-Transformer-Inference/" class="post-title-link" itemprop="url">KV Cache in Transformer Inference</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-12-26 18:29:30 / Modified: 21:19:37" itemprop="dateCreated datePublished" datetime="2023-12-26T18:29:30+01:00">2023-12-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
                </span>
            </span>

          
            <span id="/2023/12/26/KV-Cache-in-Transformer-Inference/" class="post-meta-item leancloud_visitors" data-flag-title="KV Cache in Transformer Inference" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>KV Cache is an important technique used in transformer-decoder based models during inference, which can save much computation cost and make the inference faster.</p>
<p>Since the transformer-decoder based model is auto-regressive model, i.e. it generates new token one by one at each time step. Every time we get a new token, we append this new token to the input tokens of the model to generate a sequence of output tokens, the last token of output will be another new token. We repeat this generation process until we get the end of text token or hit to the limit of max sequence length.</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/12/26/KV-Cache-in-Transformer-Inference/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ichbinhandsome.github.io/2023/12/24/Coding-Transformer-model-from-scratch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruixiang Wang">
      <meta itemprop="description" content="somthing interesting">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruixiang's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/24/Coding-Transformer-model-from-scratch/" class="post-title-link" itemprop="url">Coding Transformer model from scratch</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-24 21:05:32" itemprop="dateCreated datePublished" datetime="2023-12-24T21:05:32+01:00">2023-12-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-01-27 16:03:41" itemprop="dateModified" datetime="2024-01-27T16:03:41+01:00">2024-01-27</time>
              </span>

          
            <span id="/2023/12/24/Coding-Transformer-model-from-scratch/" class="post-meta-item leancloud_visitors" data-flag-title="Coding Transformer model from scratch" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Here is a simple PyTorch implementation of transformer model.<br>Basically the implementation has following components:</p>
<ul>
<li>Building Blocks: Multi-Head Attention, Position-Wise Feed-Forward Networks, Positional Encoding</li>
<li>Building Encoder and Decoder layers</li>
<li>Combining Encoder and Decoder layers to create complete Transformer model</li>
</ul>
<p><img src="https://raw.githubusercontent.com/ichbinhandsome/images/main/202312252026150.png" alt="transformer_architecture"></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/12/24/Coding-Transformer-model-from-scratch/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ichbinhandsome.github.io/2023/11/22/Coding-Llama2-model-from-scratch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruixiang Wang">
      <meta itemprop="description" content="somthing interesting">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruixiang's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/22/Coding-Llama2-model-from-scratch/" class="post-title-link" itemprop="url">Coding Llama2 model from scratch</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-11-22 22:44:18" itemprop="dateCreated datePublished" datetime="2023-11-22T22:44:18+01:00">2023-11-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-02-04 01:30:49" itemprop="dateModified" datetime="2024-02-04T01:30:49+01:00">2024-02-04</time>
              </span>

          
            <span id="/2023/11/22/Coding-Llama2-model-from-scratch/" class="post-meta-item leancloud_visitors" data-flag-title="Coding Llama2 model from scratch" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This blog will implement decoder-based model llama2 from scratch with PyTorch to get better understanding of model structure and some tricks used in the model.<br><img src="https://raw.githubusercontent.com/ichbinhandsome/images/main/202311261826560.png" alt="llama"></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/11/22/Coding-Llama2-model-from-scratch/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ichbinhandsome.github.io/2023/10/22/Attention-Implementaion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruixiang Wang">
      <meta itemprop="description" content="somthing interesting">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruixiang's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/Attention-Implementaion/" class="post-title-link" itemprop="url">Multi-Head Self Attention Implementation</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-10-22 22:56:35" itemprop="dateCreated datePublished" datetime="2023-10-22T22:56:35+02:00">2023-10-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-03-10 22:54:03" itemprop="dateModified" datetime="2024-03-10T22:54:03+01:00">2024-03-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
                </span>
            </span>

          
            <span id="/2023/10/22/Attention-Implementaion/" class="post-meta-item leancloud_visitors" data-flag-title="Multi-Head Self Attention Implementation" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This blog summarizes the implementation of attention for encoder and decoder in transformer model.</p>
<p><img src="https://raw.githubusercontent.com/ichbinhandsome/images/main/202310222318080.png" alt="attention equation"></p>
<p><img src="https://raw.githubusercontent.com/ichbinhandsome/images/main/202311182221870.png" alt="scaled_dot_product_attention &amp; multi-head attention"></p>
<h3 id="Pytorch-Implementation"><a href="#Pytorch-Implementation" class="headerlink" title="Pytorch Implementation"></a>Pytorch Implementation</h3>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/10/22/Attention-Implementaion/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ichbinhandsome.github.io/2023/05/13/ML_DL_algo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruixiang Wang">
      <meta itemprop="description" content="somthing interesting">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruixiang's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/13/ML_DL_algo/" class="post-title-link" itemprop="url">Implementation of ML & DL & NLP algorithms (WIP)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-13 18:53:38" itemprop="dateCreated datePublished" datetime="2023-05-13T18:53:38+02:00">2023-05-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-03-17 04:28:36" itemprop="dateModified" datetime="2024-03-17T04:28:36+01:00">2024-03-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
                </span>
            </span>

          
            <span id="/2023/05/13/ML_DL_algo/" class="post-meta-item leancloud_visitors" data-flag-title="Implementation of ML & DL & NLP algorithms (WIP)" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This blog aims to implement some important Machine Learning, Deep Learning, Natural Language Processing, Large Language Models related algorithms from scratch, which can help people get deeper understanding about how these algorithms work in real code. </p>
<ul>
<li><a href="#classic-machine-learning-algorithms">Classic Machine Learning algorithms</a><ul>
<li><a href="#k-means">K-means</a></li>
<li><a href="#knn-implementation">KNN implementation</a></li>
<li><a href="#logistic-regression">Logistic regression</a></li>
<li><a href="#linear-regression">Linear Regression</a></li>
<li><a href="#activation-functions">Activation Functions</a></li>
<li><a href="#loss-functions">Loss Functions</a></li>
<li><a href="#evaluation-metrics">Evaluation metrics</a><ul>
<li><a href="#recall-precision-f1-accuracy">Recall, Precision, F1, accuracy</a></li>
<li><a href="#marco--micro-average-recallprecision">Marco &amp; Micro average recall/precision</a></li>
<li><a href="#roc-and-auc">ROC and AUC</a></li>
<li><a href="#bleu-score">BLEU score</a></li>
<li><a href="#rouge-score">Rouge score</a></li>
<li><a href="#perplexity">Perplexity</a></li>
<li><a href="#mrr-map-ndcg">MRR, MAP, NDCG</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#deep-learning-algorithms">Deep Learning algorithms</a><ul>
<li><a href="#batch-normalization">Batch Normalization</a></li>
<li><a href="#layer-normalization">Layer Normalization</a></li>
<li><a href="#dropout">Dropout</a></li>
<li><a href="#optimizers">Optimizers</a><ul>
<li><a href="#sgd-stochastic-gradient-descent">SGD (Stochastic Gradient Descent)</a></li>
<li><a href="#mini-batch-gradient-descent-bgd">Mini-Batch Gradient Descent (BGD)</a></li>
<li><a href="#momentum">Momentum</a></li>
<li><a href="#adagrad-adaptative-gradient">Adagrad (Adaptative Gradient)</a></li>
<li><a href="#adadelta">Adadelta</a></li>
<li><a href="#rmsprop-root-mean-square-propagation">RMSProp (Root Mean Square Propagation)</a></li>
<li><a href="#adam-adaptive-moment-estimation">Adam (Adaptive Moment Estimation)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cv-algorithms">CV algorithms</a><ul>
<li><a href="#cnn">CNN</a></li>
</ul>
</li>
<li><a href="#nlp-algorithms">NLP algorithms</a><ul>
<li><a href="#basic-preprocessing">Basic Preprocessing</a></li>
<li><a href="#cosine-similarity">Cosine similarity</a></li>
<li><a href="#tf-idf">TF-IDF</a></li>
<li><a href="#fasttext">FastText</a></li>
<li><a href="#rnn-implementation">RNN implementation</a></li>
</ul>
</li>
<li><a href="#llm-algorithms">LLM algorithms</a><ul>
<li><a href="#lora-low-rank-adaption-implementation">LoRA (Low Rank Adaption) Implementation</a></li>
<li><a href="#autoregressive-decoding">Autoregressive decoding</a></li>
<li><a href="#speculative-decoding">Speculative Decoding</a></li>
</ul>
</li>
<li><a href="#mathematics">Mathematics</a><ul>
<li><a href="#different-distributions">Different distributions</a></li>
</ul>
</li>
<li><a href="#references">References</a>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/05/13/ML_DL_algo/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ichbinhandsome.github.io/2022/01/17/job-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruixiang Wang">
      <meta itemprop="description" content="somthing interesting">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruixiang's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/17/job-summary/" class="post-title-link" itemprop="url">2021ç§‹æ‹›å›é¡¾</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-17 22:48:37" itemprop="dateCreated datePublished" datetime="2022-01-17T22:48:37+01:00">2022-01-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-22 22:47:25" itemprop="dateModified" datetime="2023-11-22T22:47:25+01:00">2023-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jobs/" itemprop="url" rel="index"><span itemprop="name">jobs</span></a>
                </span>
            </span>

          
            <span id="/2022/01/17/job-summary/" class="post-meta-item leancloud_visitors" data-flag-title="2021ç§‹æ‹›å›é¡¾" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>æœ€è¿‘æ‰æœ‰å¿™é‡Œå·é—²ä»¥åšå®¢çš„å½¢å¼å›é¡¾ä¸€ä¸‹2021å¹´ç§‹æ‹›çš„ç»å†ï¼Œè¶ç€è®°å¿†å‹‰å¼ºçƒ­ä¹ï¼Œå°½ç®¡å·²ç»è¿‡å»äº†ä¸‰ä¸ªå¤šæœˆï¼Œæˆ‘ä¹Ÿå·²ç»æœ‰ä¸‰ä¸ªæœˆæ²¡æœ‰å‚åŠ è¿‡é¢è¯•ã€‚è¿™å¤§åŠå¹´æ¥ä¸€ç›´åœ¨eBayè¿™è¾¹å®ä¹ ï¼ŒåäºŒæœˆä»½æˆ‘çš„æ¯•è®¾ä¹Ÿå¼€é¢˜äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è‚å®Œæ¯•ä¸šğŸ“ã€‚æ¯”è¾ƒä»¤æˆ‘æƒ³ä¸åˆ°æ˜¯æ¯•è®¾å¼€é¢˜éƒ½ç»™æˆ‘å¼€äº†å››ä¸ªæœˆï¼Œå®åœ¨æ˜¯æ‹–å¾—æœ‰å¤Ÿä¹…ã€‚æ‰€ä»¥å†æœ‰äººé—®æˆ‘æ¥äºšç›æ€ä¹ˆæ ·ï¼Œæˆ‘ä¼šåŠé€€ä»–å¦‚æœè¿½æ±‚æ€§ä»·æ¯”å’Œä»¥æ‰¾å·¥ä½œä¸ºç›®çš„çš„è¯ä¸è¦æ¥ã€‚ã€‚ã€‚é—²è¯å°‘è¯´ï¼Œå¼€å§‹æ­£é¢˜ã€‚</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/01/17/job-summary/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ichbinhandsome.github.io/2022/01/16/%E9%95%BF%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E8%B0%83%E7%A0%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruixiang Wang">
      <meta itemprop="description" content="somthing interesting">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruixiang's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/16/%E9%95%BF%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E8%B0%83%E7%A0%94/" class="post-title-link" itemprop="url">é•¿æ–‡æœ¬åˆ†ç±»è°ƒç ”</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-16 04:06:07" itemprop="dateCreated datePublished" datetime="2022-01-16T04:06:07+01:00">2022-01-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-15 23:33:05" itemprop="dateModified" datetime="2022-01-15T23:33:05+01:00">2022-01-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NLP/" itemprop="url" rel="index"><span itemprop="name">NLP</span></a>
                </span>
            </span>

          
            <span id="/2022/01/16/%E9%95%BF%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E8%B0%83%E7%A0%94/" class="post-meta-item leancloud_visitors" data-flag-title="é•¿æ–‡æœ¬åˆ†ç±»è°ƒç ”" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><em>æ•´ç†ä¸€ä¸‹ä¹‹å‰åœ¨è…¾è®¯å®ä¹ æ—¶å€™çš„ä¸€äº›ç¬”è®°ï¼Œé¡ºä¾¿å†ç†Ÿæ‚‰ä¸€ä¸‹åšå®¢æ€ä¹ˆä¸Šä¼ æ–‡ç« ï¼Œå¥½ä¹…æ²¡æœ‰æè¿‡ï¼Œå†åŠ ä¸Šæ¢äº†æ–°ç”µè„‘ï¼Œéœ€è¦æŠŠè¿™ä¸ªåšå®¢æºä»£ç è¿ç§»ä¸€ä¸‹</em>ã€‚ã€‚ã€‚</p>
<p>é•¿æ–‡æœ¬çš„å¤„ç†åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸­ä¸€ç›´æ˜¯æ¯”è¾ƒéš¾çš„é—®é¢˜ï¼Œåœ¨å¦‚ä»ŠBERTç«çˆ†çš„æƒ…å†µä¸‹ï¼Œå‡ ä¹æ‰€æœ‰çš„æ–‡æœ¬åˆ†ç±»ä»»åŠ¡éƒ½ä¼šä½¿ç”¨BERTä½œä¸ºé¢„è®­ç»ƒæ¨¡å‹ï¼Œä¹‹ååœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸­å¯¹å…¶è¿›è¡Œå¾®è°ƒã€‚ç”±äºBERTçš„è¾“å…¥å¿…é¡»æ˜¯ä¸€ä¸ªå›ºå®šé•¿åº¦ä¸º512çš„tokenï¼Œæ‰€ä»¥åœ¨é¢å¯¹é•¿æ–‡æœ¬æ—¶å¤§éƒ¨åˆ†éƒ½ä¼šé€‰æ‹©æˆªæ–­çš„å¤„ç†æ–¹å¼ï¼šæ¯”å¦‚åªæˆªå–å¼€å¤´æˆ–è€…æˆªå–å¼€å¤´å’Œç»“å°¾ã€‚ä½†æ˜¯è¿™æ ·å°±ä¼šæŸå¤±è®¸å¤šæ–‡æœ¬ä¸­çš„ä¸€äº›å…³é”®ä¿¡æ¯ã€‚æœ¬æ–‡è°ƒç ”äº†ç›®å‰å·¥ä¸šç•Œå’Œå­¦æœ¯ç•Œä¸­ä¸é‡‡ç”¨ç®€å•æˆªæ–­å¯¹é•¿æ–‡æœ¬åˆ†ç±»ç›¸å…³é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/01/16/%E9%95%BF%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E8%B0%83%E7%A0%94/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ichbinhandsome.github.io/2020/11/13/smartQandA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruixiang Wang">
      <meta itemprop="description" content="somthing interesting">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruixiang's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/13/smartQandA/" class="post-title-link" itemprop="url">æ™ºèƒ½é—®ç­”è°ƒç ”</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-13 19:55:15" itemprop="dateCreated datePublished" datetime="2020-11-13T19:55:15+01:00">2020-11-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-15 21:57:22" itemprop="dateModified" datetime="2022-01-15T21:57:22+01:00">2022-01-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NLP/" itemprop="url" rel="index"><span itemprop="name">NLP</span></a>
                </span>
            </span>

          
            <span id="/2020/11/13/smartQandA/" class="post-meta-item leancloud_visitors" data-flag-title="æ™ºèƒ½é—®ç­”è°ƒç ”" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ä¸»è¦æµç¨‹"><a href="#ä¸»è¦æµç¨‹" class="headerlink" title="ä¸»è¦æµç¨‹"></a>ä¸»è¦æµç¨‹</h2><p><strong>Query</strong> ==&gt; <strong>Knowledge Base (Q-A Pair)</strong> ==&gt; <strong>Answer</strong></p>
<p>åŸåˆ™ï¼š<strong>çŒœä½ æ‰€æƒ³ï¼Œç­”ä½ æ‰€é—®</strong></p>
<p>ç›¸å…³é¢†åŸŸï¼šæœç´¢+è‡ªç„¶è¯­è¨€å¤„ç†+æ¨è</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/11/13/smartQandA/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ruixiang Wang</p>
  <div class="site-description" itemprop="description">somthing interesting</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ichbinhandsome" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;ichbinhandsome" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/besser-46" title="Zhihu â†’ https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;besser-46" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/ruixiang-wang-85769a199" title="LinkedIn â†’ https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;ruixiang-wang-85769a199" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.kaggle.com/wangruixiang07" title="Kaggle â†’ https:&#x2F;&#x2F;www.kaggle.com&#x2F;wangruixiang07" rel="noopener" target="_blank"><i class="fab fa-kaggle fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fas fa-biohazard"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ruixiang Wang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"bgBMKRcFSCM47e8KkwhkNhxA-MdYXbMMI","app_key":"gyzjWP17vkNtWyHEjWdY5c8Y","server_url":null,"security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":250,"height":500},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body>
</html>
